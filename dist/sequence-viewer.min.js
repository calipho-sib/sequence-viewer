/*! sequence-viewer 2016-10-05 */
var Sequence=function(){function a(a,b){function c(a,b,c){(new Date).getTime();0===a.length&&$(u+" .fastaSeq").html(w);var e=w,f=e.toString(),g=0,h=0;for(i in a)g=d(a[i].start),h=d(a[i].end),f=f.substring(0,g)+"<span class='stringsSelected' style=\"background:"+b+';color:white;">'+f.substring(g,h)+"</span>"+f.substring(h,f.length);$(u+" .fastaSeq").html(f)}function d(a){var b=a+~~(a/10)+4*~~(a/z.charsPerLine);return b}function e(b){for(var c=b.slice(),d=0;d<=b.length-1;d++)0===d?(b[0].start>0&&c.unshift({start:0,end:b[0].start,color:"black",underscore:!1}),d===b.length-1&&c.push({start:b[d].end,end:a.length,color:"black",underscore:!1})):d===b.length-1?(b[d-1].end<b[d].start&&c.push({start:b[d-1].end,end:b[d].start,color:"black",underscore:!1}),b[d].end<a.length-1&&c.push({start:b[d].end,end:a.length,color:"black",underscore:!1})):b[d-1].end<b[d].start&&c.push({start:b[d-1].end,end:b[d].start,color:"black",underscore:!1}),0!==d&&b[d-1].end>b[d].start&&console.warn("WARNING (error): Some positions in the coverage list are overlapping");return c.sort(function(a,b){return a.start-b.start}),c}function f(a,b){for(var c=$(a).html().split("<br>"),d=parseInt($(a).attr("display-option")),e=[],f=0,g=0;g<c.length;g++)e.push(f+1+"<br>"),f+=d;$(b).html(e.join(""))}function g(a){var b=parseInt($(a).attr("display-option"));b=(b+b/10).toString();var c=$(a).html();c=c.toString().match(/.{1,10}/g).join(" ").match(new RegExp(".{1,"+b+"}","g")).join("<br>"),x=c,$(a).html(c)}function h(a){a?$(u+" .sequenceHeader").append('<input class="inputSearchSeq form-control pull-right" type="text" style="width:40%;margin-top: 3px;" placeholder="Search in sequence.. (Regex supported)">'):$(u+" .sequenceBody").prepend('<input class="inputSearchSeq form-control" type="text" style="width:100%;margin:3px auto 10px;" placeholder="Search in sequence.. (Regex supported)">'),j()}function j(){$(u+" .inputSearchSeq").keyup(function(){var b=$(this).val(),d=/\S/.test(b);if(d){for(var e,f=new RegExp(b,"gi"),g=[];null!=(e=f.exec(a));)g.push({start:e.index,end:e.index+e[0].length});g.sort(function(a,b){return b.start-a.start}),k(g),c(g,"#C50063")}else $(u+" .fastaSeq").html(x)})}function k(b){var c=l(b,a);c&&m(c)}function l(a,b){var c=[];return a.length&&a.forEach(function(a){c.push({start:a.start+1,end:a.end,sequence:b.substring(a.start,a.end)})}),c}function m(a){if(CustomEvent){var b=new CustomEvent(s.events.SEQUENCE_SELECTED_EVENT,{detail:a});v.dispatchEvent(b)}else console.warn("CustomEvent is not defined....");s.trigger&&s.trigger(s.events.SEQUENCE_SELECTED_EVENT,a)}function n(){$(u+" .fastaSeq").mouseup(function(){var a=o();a&&p(a)})}function o(){var a=window.getSelection().toString().replace(/\s+/g,""),b=window.getSelection(),c=$(u+" .fastaSeq")[0],d=0,e=$(u+" .fastaSeq").text(),f=b.getRangeAt(0),g=f.cloneRange();g.selectNodeContents(c),g.setEnd(f.endContainer,f.endOffset),d=g.toString().length;var h=e.substring(0,d).replace(/\s+/g,"").length,i=h-(a.length-1),j={text:a,start:i,end:h};return j}function p(a){if(CustomEvent){var b=new CustomEvent(s.events.MOUSE_SELECTION_EVENT,{detail:{selection:a.text,start:a.start,end:a.end}});v.dispatchEvent(b)}else console.warn("CustomEvent is not defined....");s.trigger&&s.trigger(s.events.MOUSE_SELECTION_EVENT,{selection:a})}function q(a){z.charsPerLine=a.value,s.render(u,z),y.data.length&&s.coverage(y.data,y.start,y.end,y.hlColor)}function r(){var a=t?"hidden-xs":"",b='<form class="form-inline" style="margin-bottom:5px;"><div class="form-group form-group-sm sequenceToolbar" style=""> <label class="control-label charPerLine-label '+a+"\" for='"+u.substring(1)+"-cpl' style='margin-right:5px;'>"+z.header.unit+' per line</label><select class="CPLChoice form-control '+a+"\" id='"+u.substring(1)+"-cpl' style='display:inline-block;width:auto;margin-right:10px;'><option>Select</option><option value=50>50</option><option value=60>60</option><option value=70>70</option><option value=80>80</option><option value=90>90</option><option value=100>100</option></select></div></form>";$(u+" .sequenceBody").prepend(b),$(u+" .CPLChoice").change(function(){q(this),$(u+" .CPLChoice option:selected").text($(this).val())})}var s=this;this.events={MOUSE_SELECTION_EVENT:"sequence-viewer-mouse-selection",SEQUENCE_SELECTED_EVENT:"sequence-viewer-substring-selected"};var t;t=void 0!==b?b:"",console.log(t);var u,v,a=a,w="",x="",y={data:[],start:null,end:null,hlColor:null},z={};this.render=function(b,c){if("string"!=typeof b)throw new Error("Div identifier must be a string");if(u=b,v=document.getElementById(b.substring(1)),null===v)throw new Error("Cannot find element with id: "+b.substring(1));c||(c={}),z.showLineNumbers=void 0===c.showLineNumbers?!0:c.showLineNumbers,z.wrapAminoAcids=void 0===c.wrapAminoAcids?!0:c.wrapAminoAcids,z.sequenceMaxHeight=void 0===c.sequenceMaxHeight?"400px":c.sequenceMaxHeight,z.title=void 0===c.title?"Protein Sequence":c.title,z.charsPerLine=void 0===c.charsPerLine?30:c.charsPerLine,z.search=void 0===c.search?!1:c.search,z.toolbar=void 0===c.toolbar?!1:c.toolbar,z.badge=void 0===c.badge?!0:c.badge,z.header=c.header?{display:void 0===c.header.display?!0:c.header.display,searchInTitle:void 0===c.header.searchInTitle?!0:c.header.searchInTitle,unit:void 0===c.header.unit?"Char":c.header.unit,showCpl:void 0===c.header.showCpl?!0:c.header.showCpl,badgeWithUnit:void 0===c.header.badgeWithUnit?!1:c.header.badgeWithUnit}:{display:!0,searchInTitle:!0,unit:"Char",showCpl:!0,badgeWithUnit:!1};var d='<div style="display:inline-block;"><span class="badge" style="border-radius:70%;border: 2px solid black;color:#C50063;padding:8px 5px;background-color:white;margin-right:10px;vertical-align:middle;min-width:32px;">'+a.length+"</span></div>",e='<div style="display:inline-block;"><span class="badge" style="border-radius:70%;border: 2px solid black;color:#C50063;padding:5px 5px;background-color:white;margin-right:10px;vertical-align:middle;min-width:32px;font-size:11px;">'+a.length+"<div style='margin-top:-2px;font-size:9px;color:black;text-transform:lowercase;'>"+z.header.unit+"</div></span></div>",i=z.badge?z.header.badgeWithUnit?e:d:"",j=z.header.display?'<div class="sequenceHeader row" style="border-bottom: 1px solid #E7EAEC;padding-bottom:5px;margin:0px 0px 10px">'+i+'<h4 style="display:inline-block;vertical-align:middle;">'+z.title+"</h4></div>":"",k=j+'<div class="sequenceBody" style="margin-top: 5px;"><div class="scroller" style="max-height:'+z.sequenceMaxHeight+';overflow:auto;white-space: nowrap;padding-right:20px;margin-right:10px;"><div class="charNumbers" style="font-family: monospace;font-size: 13px;display:inline-block;text-align:right; padding-right:5px; border-right:1px solid LightGray;"></div><div class="fastaSeq" display-option="'+z.charsPerLine+'" style="font-family: monospace;font-size: 13px;display:inline-block;padding:5px;">'+a+'</div></div><div class="coverageLegend" style="margin-top: 10px;margin-left:15px;"></div></div>';if($(b).html(k),z.wrapAminoAcids?g(b+" .fastaSeq"):$(b+" .scroller").css("overflow-x","auto"),z.showLineNumbers&&f(b+" .fastaSeq",b+" .charNumbers"),z.toolbar){if(z.header.showCpl)r();else{var l='<form class="form-inline" style="margin-bottom:5px;"><div class="form-group form-group-sm sequenceToolbar" style=""> </div></form>';$(u+" .sequenceBody").prepend(l)}""!==t&&$(u+" .sequenceToolbar").append('<a class="btn btn-default btn-sm fasta-link" href="http://www.nextprot.org/entry/'+t.split("-")[0]+"/fasta?isoform="+t.slice(3)+'" target=\'_blank\'>View FASTA</a><div class="btn-group" role="group" aria-label="..." style="margin-left:5px;" data-toggle="tooltip" data-placement="top" title="Soon to be implemented"><a class="btn btn-default btn-sm disabled" style="margin-left:-1px;" href="">BLAST sequence</a><a class="btn btn-default btn-sm disabled" href="">BLAST selection</a></div>')}if(z.search){var m=z.header.searchInTitle;h(m)}w=$(b+" .fastaSeq").html(),n()},this.selection=function(a,b,c,d){var e=[a,b],f=w;k([{start:a,end:b}]),e[0]=e[0]+~~(e[0]/10)+4*~~(e[0]/z.charsPerLine),e[1]=e[1]+~~(e[1]/10)+4*~~(e[1]/z.charsPerLine);f=f.substring(0,e[0])+"<span class='stringSelected' style=\"background:"+c+';color:white;">'+f.substring(e[0],e[1])+"</span>"+f.substring(e[1],f.length),$(u+" .fastaSeq").html(f)},this.addLegend=function(a){for(var b=0;b<a.length;b++)a[b].underscore===!0?$(u+" .coverageLegend").append('<div style="display:inline-block;background:'+a[b].color+';width:20px;height:20px;vertical-align:middle;margin:0px 5px 0px 10px;border-radius:50%; border: 1px solid grey;text-align:center; line-height:0.8;">_</div><p style="display:inline-block;font-weight:bold;font-size:11px;font-style:italic;margin:0;padding-top:3px;vertical-align:top;">'+a[b].name+"</p></div>"):$(u+" .coverageLegend").append('<div style="display:inline-block;background:'+a[b].color+';width:20px;height:20px;vertical-align:middle;margin:0px 5px 0px 10px;border-radius:50%;"></div><p style="display:inline-block;font-weight:bold;font-size:11px;font-style:italic;margin:0;padding-top:3px;vertical-align:top;">'+a[b].name+"</p>")},this.coverage=function(a,b,c,f){y.data=jQuery.extend(!0,[],a),y.start=b,y.end=c,y.hlColor=f,a.sort(function(a,b){return a.start-b.start}),a=e(a);(new Date).getTime();if(!b)var b=0;if(!c)var c=0;if(!f)var f="#FFE5A3";for(var g="",h="",i=0;i<a.length;i++){var j="";void 0!==a[i].tooltip&&(j=' title="'+a[i].tooltip+'"');var k="";void 0!==a[i].bgcolor&&(k="background:"+a[i].bgcolor+";");var l="",m="";void 0!==a[i].onclick&&(l=' onclick=" return '+i+';" ',m="cursor: pointer;"),a[i].underscore?(h='<span style="text-decoration:underline;color:'+a[i].color+";"+k+m+'"'+j+l+">",g+=h):(h='<span style="color:'+a[i].color+";"+k+m+'"'+j+l+">",g+=h),c?b>=a[i].start&&b<a[i].end&&c>=a[i].start&&c<a[i].end?(g+=w.substring(d(a[i].start),d(b))+'<span class="peptideHighlighted" style="background:'+f+';">'+w.substring(d(b),d(c+1)),g+="</span>"+w.substring(d(c+1),d(a[i].end))+"</span>"):g+=b>=a[i].start&&b<a[i].end?w.substring(d(a[i].start),d(b))+'</span><span class="peptideHighlighted" style="background:'+f+';">'+h+w.substring(d(b),d(a[i].end))+"</span>":c>=a[i].start&&c<a[i].end?w.substring(d(a[i].start),d(c+1))+"</span></span>"+h+w.substring(d(c+1),d(a[i].end))+"</span>":w.substring(d(a[i].start),d(a[i].end))+"</span>":g+=w.substring(d(a[i].start),d(a[i].end))+"</span>"}var n=$(u+" .fastaSeq");n.html(g),x=g;for(var o=$("[onclick]",n),i=0;i<o.length;i++){var p=o[i].onclick();o[i].onclick=a[p].onclick}},this.onMouseSelection=function(a){v.addEventListener(s.events.MOUSE_SELECTION_EVENT,a)},this.onSubpartSelected=function(a){v.addEventListener(s.events.SEQUENCE_SELECTED_EVENT,a)}}return a}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=Sequence);